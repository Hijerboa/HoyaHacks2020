<!DOCTYPE html>
<html lang="en">
    <head>
        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" 
            integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" 
            crossorigin="anonymous">
        </script>
        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" 
            integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" 
            crossorigin="anonymous">
        </script>
        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js" 
            integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg==" 
            crossorigin="anonymous">
        </script>
        <script 
            src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" 
            integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" 
            crossorigin="anonymous">
        </script>
        <link 
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" 
            rel="stylesheet" 
            integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" 
            crossorigin="anonymous">
        <script src="js/index.js"></script>
    </head>
    <body>
        <header>
        </header>
        <section id="bodyContainer">
            <div class="container fluid">
                <div class="row">
                    <div class="col">
                        <input id="txtTickerSymbol" type="text" placeholder="Ticker Symbol"/>
                    </div>
                    <div class="col">
                        <div class="row">
                            <div class="col">
                                <input value="Hour" onclick="generateNewChart('Hour')" type="button" class="btn btn-primary"/>
                            </div>
                            <div class="col">
                                <input value="Day" onclick="generateNewChart('Day')" type="button" class="btn btn-success"/>
                            </div>
                            <div class="col">
                                <input value="Week" onclick="generateNewChart('Week')" type="button" class="btn btn-info"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <input id="dtStartDate" type="date"/>
                    </div>
                    <div class="col">
                        <input id="dtStopDate" type="date"/>
                    </div>
                </div>
                <div class="row">
                    <canvas id="stonkChart"></canvas>
                    <script>
                        let chart = null;
    
                        function generateNewChart(interval) {
                            if (interval !== "Hour" && interval !== "Day" && interval !== "Week") {
                                // Write to error label
                                return;
                            }

                            if (chart !== null) {
                                chart.destroy();
                            }
                            
                            var ticker = $("#txtTickerSymbol").val();
                            var start_date = moment($("#dtStartDate").val()).toISOString();
                            var stop_date = moment($("#dtStopDate").val()).toISOString();

                            // TODO: Validate the ticker, start date and end date

                            var ctx = $("#stonkChart").get(0).getContext("2d");
                            if (chart !== null) {
                                chart.destroy();
                            }

                            let redditData, marketData;

                            requestChartData(ticker, start_date, stop_date, interval)
                                // Promise succeeded, got the data
                                .then(([redditData, marketData]) => {
                                    console.log(redditData, marketData);
                                    chart = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            datasets: [/*{
                                                // TODO: This needs filled in
                                                label: '',
                                                data: stonkData['']
                                            },*/ {
                                                label: 'Number of Posts',
                                                data: redditData,
                                                // Overrides the chart type to line for this dataset
                                                //type: 'line'
                                            }, {
                                                label: 'Stock Price',
                                                data: marketData,
                                                // Overrides the chart type to line for this dataset
                                                //type: 'line'
                                            }]
                                        } 
                                    });
                                });
                        }
                    </script>
                </div>
            </div>
            
        </section>
        <footer>

        </footer>
    </body>
</html>